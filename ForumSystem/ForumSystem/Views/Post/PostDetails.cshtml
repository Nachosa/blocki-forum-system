@model ForumSystemDTO.ViewModels.PostViewModels.PostDetailsViewModel;

@{
    bool isAuthenticated = !string.IsNullOrEmpty(Context.Session.GetString("LoggedUser"));
    bool isLoggedUserPost = Context.Session.GetInt32("userId") == Model.User.Id;
    int? loggedUserId = Context.Session.GetInt32("userId");
    bool isAdmin = this.Context.Session.GetInt32("roleId") == 3;
    bool loggedUserLiked = this.Model.Likes.Any(l => l.UserId == loggedUserId && l.IsDislike == false && l.IsDeleted == false);
    bool loggedUserDisliked = this.Model.Likes.Any(l => l.UserId == loggedUserId && l.IsDislike == true && l.IsDeleted == false);
    //TODO: Проверка за блокиран.
}

<div class="body-content">

    <h2>@Model.Title</h2>
    <p>Created By: <a asp-controller="User" asp-action="UserDetails" asp-route-id="@Model.User.Id">@Model.CreatedBy</a></p>
    <p>Created On: @Model.CreatedOn</p>
    <!-- #region Likes and Dislikes -->
    @if (loggedUserLiked == false && loggedUserDisliked == false)
    {
        <p><a asp-controller="Post" asp-action="LikePost" asp-route-id="@Model.Id">Likes: @Model.LikesCount</a></p>
        <p><a asp-controller="Post" asp-action="DislikePost" asp-route-id="@Model.Id">Dislikes: @Model.DislikesCount</a></p>
    }
    else if (loggedUserLiked == true)
    {
        <p><a style="color:lawngreen" asp-controller="Post" asp-action="LikePost" asp-route-id="@Model.Id">Likes: @Model.LikesCount</a></p>
        <p><a asp-controller="Post" asp-action="DislikePost" asp-route-id="@Model.Id">Dislikes: @Model.DislikesCount</a></p>
    }
    else if (loggedUserDisliked == true)
    {
        <p><a asp-controller="Post" asp-action="LikePost" asp-route-id="@Model.Id">Likes: @Model.LikesCount</a></p>
        <p><a style="color:lawngreen" asp-controller="Post" asp-action="DislikePost" asp-route-id="@Model.Id">Dislikes: @Model.DislikesCount</a></p>
    }
    <!-- #endregion -->
    <p>Tags: @(Model.Tags.Any() ? string.Join(", ", Model.Tags) : "none")</p>

    <h3>Content: @Model.Content</h3>

    @if (isLoggedUserPost || isAdmin)
    {
        <div class="button-container">
            <a asp-controller="Post" asp-action="Edit" asp-route-Id="@Model.Id" class="button-normal" method="get">Edit Post</a>
        </div>
        <div class="button-container">
            <a asp-controller="Post" asp-action="DeletePost" asp-route-Id="@Model.Id" class="button-normal" method="post">Delete Post</a>
        </div>
    }

    <h4>Comments</h4>
    @if (Model.Comments.Count == 0)
    {
        <p>
            <i>No comments.</i>
        </p>
    }
    else
    {
        <ul>
            @foreach (var comment in Model.Comments)
            {
                <li class="margin12">
                    <strong>@comment.Username:</strong> @comment.Content

                    @if (Context.Session.GetString("LoggedUser") == comment.Username || isAdmin)
                    {
                        <a asp-controller="Comment" asp-action="DeleteComment" asp-route-id="@comment.Id" class="btn btn-primary">Delete</a>
                        <a asp-controller="Comment" asp-action="EditComment" asp-route-id="@comment.Id" class="btn btn-primary">Edit</a>
                    }
                </li>
            }
        </ul>
    }

    @if (isAuthenticated)
    {
        <a asp-controller="Comment" asp-action="CommentForm" asp-route-id="@Model.Id" class="btn btn-primary">Add Comment</a>
    }
</div>